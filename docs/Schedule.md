# 开发过程以及未来规划

这里会记录一下整个开发过程

## 最基础的框架建好了（2024-04-15）

现在已经有了基础的UI,TXT阅读能力了,接下来有几个比较重要的事情.
1. 书籍的数据结构以及数据库表结构确立和性能优化
2. epub格式的支持(epub-parser)
3. 目录的建立
4. 虚拟列表
5. 书籍数据分块读写
6. 划线,批注,高亮功能
7. 阅读记录
8. 待定

## 放弃了一段时间后（2024-07-22）

很久没玩这个项目了，其实算起来，从利用行首行尾禁则排版计算（真的很让人觉得挫败卡住之后），就基本停滞了，总共也就用来一周把，后面陆陆续续玩了会，也都没有玩进去。首要的问题就是算法的正确性，通用性还有性能。今天用AI工具的时候，偶然获得了一个思路，用一个set存储所有的字符集（如果是英文，或许也可以存单词，CJK的话，一般的书都是在常用范围内的）
全部字符集存到数据库，然后每次需要重新计算高度（字体样式变更）的时候，先把整个字符集的宽度全都计算一遍，但是这或许又会导致另外一个问题，哎，如果后面想要更优秀的排版，例如标点符号跨度调整什么的，这又是另外一个坑，现有的计算方案或许有需要重新考虑。

## 虚拟列表的使用（2024-08-02）

现在勉勉强强可以用，不过我有注意到了一个问题，我的虚拟列表还需要重新设计，在滚动完成前，我都无法操作，必须等待滚动和计算完成，这实在是一个很失败的点……

稍微分析一下动态高度虚拟该如何计算
1. 假设全部渲染，就是正常滚动，一切都不需要考虑
2. 虚拟列表 + 真实渲染（缓冲区 + 视口）
3. 为了方便，我已经得到了每项高度
4. 那现在的滚动，需要用margin去填充虚拟部分（上部分，下部分不需要，为空就行）
5. 真实区域，则需要考虑缓冲区每次的高度变化，以及视口部分的高度变化
6. 最后就是保证好滚动条位置……

## 使用了一小段时间（2024-08-05）
其实功能还差了很多，为了快速达成能用的阶段，我走了好多个捷径，有很多东西没有仔细考虑。首先就是换行问题，一直没有解决，然后就是阅读器的样式配置（字体大小，段落间距，又或者还有字符间距），这个主要还是先把默认的配置优化到铐起来还不错的程度（照抄微信读书哈哈哈），甚至我觉得可以保持绝对主观，不开放这些修改在阅读器内部，仅仅放在app配置里面。
还想提一嘴的就是epub阅读，以及划线和批注功能，暂时没什恶魔思路·1·，因为这个和我现在的页面分页计算有关联的地方，其实段落间距也是一样的……

## 恢复了默认符号禁则，以及章节名的特殊处理（2024-08-06）
目前的算法还存在一些问题，当前章节的确定还有待商榷，误差为1个内……
然后就是符号，必定存在误差，这也需要既觉额，还好速度还可以，之后或许也能进一步优化
最后就是最开始写的定高VList,滚动和计算有点问题，我对于cahceNum的理解还不到位。之后再改。
后面会如何推进？是玩玩高亮和批注？还是支持EPUB格式？感觉支持EPUB会花费很多时间，有些难度，虽然之前有一个DEMO，但是要融入到我现有的东西里面还是有很多问题。然后是高亮和批注，还是没有啥想法，可能是还没动手干吧……
不过，我觉得目前，这个阅读器终于达到了能用的地步，正常阅读，记录位置，章节跳转读取基本功能满足了，虽然自定义暂不开放，不过我觉得我默认的配置还可以，至少自己用起来不错。之后时间充足的话，肯定会推进新功能，不然的话就是尝试codereview，改改bug了，希望不会弃坑把。

## 后续待实现功能（2024-08-08）

0. 高度计算算法的准确性和速度
1. epub格式
2. 横向翻页
3. 多端同步
4. 阅读时间记录
5. 划线与批注

感觉每个都不好弄啊，要不还是安于现状好了？